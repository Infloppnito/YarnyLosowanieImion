<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yarnowskie losowanko</title>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue&family=Quicksand:wght@500&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Quicksand', sans-serif; background: #2c2c2c; color: #f8f8f8; padding: 40px; text-align: center; }
    h1 { font-family: 'Comic Neue', cursive; font-size: 3em; background: linear-gradient(270deg, red, orange, yellow, green, blue, indigo, violet); background-size: 1400% 1400%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: rainbow 10s linear infinite; margin-bottom: 5px; }
    @keyframes rainbow { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }
    h5 { font-style: italic; color: #ffa500; margin-top: 0; margin-bottom: 40px; }
    label, input, select, button { display: block; margin: 10px auto; font-size: 1.1em; }
    input, select { padding: 10px; border-radius: 12px; border: none; width: 250px; background-color: #ffb84d; color: #fff; }
    button { background-color: #ff9800; color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; transition: background-color 0.3s ease; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    button:hover { background-color: #ff5722; }
    h2 { margin-top: 20px; color: #ffcc00; text-shadow: 1px 1px #ff9900; }
    #wynik { margin-top: 30px; font-size: 1.5em; font-weight: bold; color: #fff; background-color: rgba(255, 255, 255, 0.1); display: inline-block; padding: 15px 30px; border-radius: 20px; border: 1px solid #ffcc00; }
    .profilowe { width: 120px; height: 120px; border-radius: 50%; border: 4px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.4); margin: 20px auto; display: block; }
    .sekcja { background: rgba(255, 255, 255, 0.05); border: 2px dashed #ffcc00; border-radius: 25px; padding: 25px; margin: 40px auto; max-width: 500px; box-shadow: 0 6px 15px rgba(0,0,0,0.4); }
    .confetti { position: fixed; top: 50%; left: 50%; pointer-events: none; z-index: 9999; }
    .dot { position: absolute; width: 10px; height: 10px; border-radius: 50%; opacity: 0.8; animation: fly 1s ease-out forwards; }
    @keyframes fly {
      to {
        transform: translate(
          calc(-50px + 100px * var(--x)),
          calc(-50px + 100px * var(--y))
        );
        opacity: 0; }
    .imie-item { display: flex; justify-content: space-between; align-items: center; background-color: #ffb84d; color: white; border-radius: 20px; padding: 10px 20px; margin: 8px 0; font-weight: bold; position: relative; }
    .imie-item button { background: none; border: none; color: white; font-weight: bold; cursor: pointer; font-size: 1.2em; }
    .imie-item button:hover { color: #ff0000; }
    .social-section { position: absolute; top: 20px; right: 20px; font-size: 1.2em; color: #fff; text-align: center; }
    .social-text a { color: #ffa500; text-decoration: none; font-weight: bold; }
    .social-text a:hover { color: #ff5722; }
    .left-social { position: absolute; top: 20px; left: 20px; font-size: 1.2em; color: #fff; text-align: center; }
    .left-social a { color: #ffa500; text-decoration: none; font-weight: bold; }
    .left-social a:hover { color: #ff5722; }

    /* Nowe style */
    .admin-login-button {
      position: absolute;
      top: 20px;
      right: 160px;
      background-color: #ff9800;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 1000;
    }
    .admin-login-button:hover {
      background-color: #ff5722;
    }
  </style>
</head>
<body>


<button id="adminButton" class="admin-login-button" onclick="sprawdzAdmina()">üîë Zaloguj jako admin</button>

<h1>YARNOWSKIE LOSOWANKO</h1>
<img src="https://yt3.googleusercontent.com/eqgEExvdL14xYxUvOc_cnAEoq0__ekCH_MlADzKtl7IAgFLwo3630Vr3t1ejihIW5JRx2XCEWw=s160-c-k-c0x00ffffff-no-rj" alt="Profilowe Yarny" class="profilowe" onclick="window.open('https://www.youtube.com/@CuteAndYarny', '_blank')">
<h2><a href="https://www.instagram.com/infloppnito?igsh=ZDRiNWo3b2ZiaHdt&utm_source=qr" target="_blank">Floppy jest najlepsza UwU</a></h2>

<div class="sekcja">
  <p id="licznikImion" style="font-size: 1.2em; color: #ffcc00; margin-top: -10px;">≈Åadowanie liczby imion...</p>
  <h2>Dodaj imiƒô</h2>
  <label for="kategoria">Kategoria:</label>
  <select id="kategoria">
    <option value="ch≈Çopiec">Ch≈Çopiec</option>
    <option value="dziewczynka">Dziewczynka</option>
  </select>
  <input type="text" id="imie" placeholder="Wpisz imiƒô">
  <button onclick="dodajImie()">‚ûï Dodaj</button>
</div>

<div class="sekcja">
  <h2>Wynik losowania</h2>
  <p id="wynik"></p>
  <button onclick="losuj('ch≈Çopiec')">üé≤ Losuj imiƒô ch≈Çopca</button>
  <button onclick="losuj('dziewczynka')">üé≤ Losuj imiƒô dziewczynki</button>
</div>


<div id="adminSekcja" class="sekcja" style="display: none;">
  <h2>Panel administratora</h2>
  <div id="adminPanel" style="margin-top: 20px;">
    <button onclick="resetBaza()" style="background-color: #ff5722;">üßπ Wyczy≈õƒá wszystkie imiona</button>
    <button onclick="pokazListe()">üìú Poka≈º listƒô imion</button>
    <div id="listaImion" style="margin-top: 15px;"></div>
  </div>
</div>

<div class="social-section">
  <div>Chcesz wiƒôcej? Sprawd≈∫ Yarny na <a href="https://www.instagram.com/cuteandyarny?igsh=czEya3F4anozejF5" target="_blank">Instagramie</a>.</div>
</div>

<div class="left-social">
  <div>Nie jeste≈õ na bie≈ºƒÖco? Zobacz <a href="https://www.youtube.com/playlist?list=UULFHVQuaye22jLJptftYUssDA" target="_blank">NAJNOWSZY ODCINEK</a>.</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getDatabase, ref, push, get, remove, onValue } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAVD8RDpaA1QMCbzPaHpO9wPCPM62fKtVk",
    authDomain: "yarnylosowanieimion.firebaseapp.com",
    databaseURL: "https://yarnylosowanieimion-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "yarnylosowanieimion",
    storageBucket: "yarnylosowanieimion.appspot.com",
    messagingSenderId: "608978297511",
    appId: "1:608978297511:web:76f631f9cb131fdfc1b182"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  function generateUserId() {
    return localStorage.getItem('userId') || (() => {
      const id = crypto.randomUUID();
      localStorage.setItem('userId', id);
      return id;
    })();
  }

  async function getUserMetadata() {
    try {
      const res = await fetch("https://api.ipify.org?format=json");
      const ipData = await res.json();
      return {
        ip: ipData.ip || "unknown",
        userAgent: navigator.userAgent || "unknown",
        time: new Date().toISOString()
      };
    } catch (e) {
      return {
        ip: "fetch_error",
        userAgent: navigator.userAgent || "unknown",
        time: new Date().toISOString()
      };
    }
  }

  window.dodajImie = async function () {
    const kat = document.getElementById('kategoria').value;
    const imie = document.getElementById('imie').value.trim();
    if (!imie) return alert("Wpisz imiƒô!");

    const metadata = await getUserMetadata();
    const userId = generateUserId();
    const dane = {
      imie,
      dodanePrzez: userId,
      metadata
    };

    console.log("Wysy≈Çane dane do Firebase:", dane);

    await push(ref(db, kat), dane);
    alert(`Dodano imiƒô: ${imie}`);
    document.getElementById('imie').value = "";
  };

  window.losuj = async function (kat) {
    const snapshot = await get(ref(db, kat));
    if (!snapshot.exists()) {
      document.getElementById('wynik').textContent = "Brak imion w tej kategorii.";
      return;
    }
    const imiona = Object.values(snapshot.val()).map(obj => obj.imie);
    const los = imiona[Math.floor(Math.random() * imiona.length)];
    showConfetti();
    document.getElementById('wynik').textContent = `üéâ Wylosowane imiƒô (${kat}): ${los}`;
  };

  window.resetBaza = async function () {
    if (confirm("Na pewno chcesz usunƒÖƒá wszystkie imiona?")) {
      await remove(ref(db, "ch≈Çopiec"));
      await remove(ref(db, "dziewczynka"));
      document.getElementById('wynik').textContent = "Baza zosta≈Ça zresetowana.";
      document.getElementById('listaImion').innerHTML = "";
    }
  };

  window.pokazListe = async function () {
    const katy = ['ch≈Çopiec', 'dziewczynka'];
    let html = '';
    for (const kat of katy) {
      const snap = await get(ref(db, kat));
      if (snap.exists()) {
        html += `<h3>${kat}:</h3>`;
        for (const [key, val] of Object.entries(snap.val())) {
          html += `<div class="imie-item">${val.imie} <button onclick="usunImie('${kat}', '${key}')">√ó</button></div>`;
        }
      }
    }
    document.getElementById('listaImion').innerHTML = html || "<p>Brak imion do wy≈õwietlenia.</p>";
  };

  window.usunImie = async function (kat, key) {
    if (confirm("Na pewno chcesz usunƒÖƒá to imiƒô?")) {
      await remove(ref(db, `${kat}/${key}`));
      pokazListe();
    }
  };

  window.sprawdzAdmina = function () {
    const haslo = prompt("Podaj has≈Ço administratora:");
    if (haslo === "1Yarny9Random9Names8$") {
      alert("Zalogowano jako administrator.");
      document.getElementById("adminSekcja").style.display = "block";
      const btn = document.getElementById("adminButton");
      btn.textContent = "üîí Wyloguj";
      btn.onclick = wylogujAdmina;
    } else {
      alert("B≈Çƒôdne has≈Ço!");
    }
  };

  window.wylogujAdmina = function () {
    document.getElementById("adminSekcja").style.display = "none";
    const btn = document.getElementById("adminButton");
    btn.textContent = "üîë Zaloguj jako admin";
    btn.onclick = sprawdzAdmina;
  };

    function showConfetti() {
      for (let i = 0; i < 30; i++) {
        const dot = document.createElement('div');
        dot.classList.add('dot');
        dot.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 70%)`;
        dot.style.setProperty('--x', Math.random());
        dot.style.setProperty('--y', Math.random());
        dot.classList.add('confetti');
        dot.style.left = event.clientX + 'px';
        dot.style.top = event.clientY + 'px';

        document.body.appendChild(dot);

        setTimeout(() => {
          dot.remove();
        }, 1000);
      }
    }

function aktualizujLicznikImion() {
  const rootRef = ref(db);
  onValue(rootRef, snapshot => {
    const dane = snapshot.val() || {};
    const ch≈Çopiec = dane.ch≈Çopiec || {};
    const dziewczynka = dane.dziewczynka || {};

    const liczbaCh≈Çopcow = Object.keys(ch≈Çopiec).length;
    const liczbaDziewczynek = Object.keys(dziewczynka).length;

    const licznik = document.getElementById("licznikImion");
    if (licznik) {
      licznik.textContent =
        `üî¢ Imiona ch≈Çopc√≥w: ${liczbaCh≈Çopcow} | Imiona dziewczynek: ${liczbaDziewczynek}`;
 } else {
      console.warn("Brak elementu #licznikImion w DOM!");
    }
  });
}

  window.onload = () => {
  aktualizujLicznikImion();
};

</script>

</body>
</html>
